(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-16b5b13b"],{2392:function(t,e,n){},2423:function(t,e,n){"use strict";n.d(e,"f",(function(){return r})),n.d(e,"e",(function(){return i})),n.d(e,"a",(function(){return c})),n.d(e,"c",(function(){return s})),n.d(e,"b",(function(){return o})),n.d(e,"d",(function(){return u})),n.d(e,"h",(function(){return l})),n.d(e,"g",(function(){return d})),n.d(e,"i",(function(){return h}));var a=n("b775"),r=function(t){return Object(a["a"])({method:"GET",url:"/app/v1_1/articles",params:t})},i=function(t){return Object(a["a"])({method:"GET",url:"/app/v1_0/articles/".concat(t)})},c=function(t){return Object(a["a"])({method:"POST",url:"/app/v1_0/article/collections",data:{target:t}})},s=function(t){return Object(a["a"])({method:"DELETE",url:"/app/v1_0/article/collections/".concat(t)})},o=function(t){return Object(a["a"])({method:"POST",url:"/app/v1_0/article/likings",data:{target:t}})},u=function(t){return Object(a["a"])({method:"DELETE",url:"/app/v1_0/article/likings/".concat(t)})},l=function(t){return Object(a["a"])({method:"GET",url:"/app/v1_0/user/articles",params:t})},d=function(t){return Object(a["a"])({method:"GET",url:"/app/v1_0/article/collections",params:t})},h=function(t){return Object(a["a"])({method:"GET",url:"/app/v1_0/user/histories",params:t})}},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,n){var a=n("1d80"),r=n("5899"),i="["+r+"]",c=RegExp("^"+i+i+"*"),s=RegExp(i+i+"*$"),o=function(t){return function(e){var n=String(a(e));return 1&t&&(n=n.replace(c,"")),2&t&&(n=n.replace(s,"")),n}};t.exports={start:o(1),end:o(2),trim:o(3)}},"6cab":function(t,e,n){"use strict";var a=n("f8c1"),r=n.n(a);r.a},"6eba":function(t,e,n){var a=n("23e7");a({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}})},7192:function(t,e,n){"use strict";var a=n("2392"),r=n.n(a);r.a},"7abe":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home-container"},[n("van-nav-bar",{staticClass:"page-nav-bar"},[n("van-button",{staticClass:"search-btn",attrs:{slot:"left",type:"info",size:"small",round:"",icon:"search",to:"/search"},slot:"left"},[t._v("搜索")]),n("van-icon",{attrs:{slot:"right",name:"add"},slot:"right"})],1),n("van-tabs",{staticClass:"channel-tabs",attrs:{swipeable:""},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[t._l(t.channels,(function(t){return n("van-tab",{key:t.id,attrs:{title:t.name}},[n("article-list",{ref:"article-list",refInFor:!0,attrs:{channel:t}})],1)})),n("div",{staticClass:"placeholder",attrs:{slot:"nav-right"},slot:"nav-right"}),n("div",{staticClass:"hamburger-btn",attrs:{slot:"nav-right"},on:{click:function(e){t.isChennelEditShow=!0}},slot:"nav-right"},[n("i",{staticClass:"toutiao toutiao-gengduo"})])],2),n("van-popup",{style:{height:"100%"},attrs:{closeable:"","close-icon-position":"top-left",position:"bottom"},model:{value:t.isChennelEditShow,callback:function(e){t.isChennelEditShow=e},expression:"isChennelEditShow"}},[n("channel-edit",{attrs:{"my-channels":t.channels,active:t.active},on:{"update-active":t.onUpdateActive}})],1)],1)},r=[],i=(n("96cf"),n("1da1")),c=n("5530"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"article-list",staticClass:"article-list"},[n("van-pull-refresh",{attrs:{"success-text":t.refreshSuccessText,"success-duration":1500},on:{refresh:t.onRefresh},model:{value:t.isreFreshLoading,callback:function(e){t.isreFreshLoading=e},expression:"isreFreshLoading"}},[n("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t,e){return n("article-item",{key:e,attrs:{article:t}})})),1)],1)],1)},o=[],u=(n("6eba"),n("0d03"),n("2909")),l=n("2423"),d=n("6ea2"),h=n("2ef0"),f={name:"ArticleList",components:{ArticleItem:d["a"]},props:{channel:{type:Object,required:!0}},data:function(){return{list:[],loading:!1,finished:!1,timestamp:null,error:!1,isreFreshLoading:!1,refreshSuccessText:"刷新成功",scrollTop:0}},mounted:function(){var t=this,e=this.$refs["article-list"];e.onscroll=Object(h["debounce"])((function(){t.scrollTop=e.scrollTop}),50)},activated:function(){this.$refs["article-list"].scrollTop=this.scrollTop},methods:{onLoad:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(l["f"])({channel_id:t.channel.id,timestamp:t.timestamp||Date.now(),with_top:1});case 3:a=e.sent,r=a.data,i=r.data.results,(n=t.list).push.apply(n,Object(u["a"])(i)),t.loading=!1,i.length?t.timestamp=r.data.pre_timestamp:t.finished=!0,e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](0),t.error=!0,t.loading=!1;case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))()},onRefresh:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(l["f"])({channel_id:t.channel.id,timestamp:Date.now(),with_top:1});case 3:a=e.sent,r=a.data,i=r.data.results,(n=t.list).unshift.apply(n,Object(u["a"])(i)),t.isreFreshLoading=!1,t.refreshSuccessText="刷新成功，更新了".concat(i.length,"条数据"),e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](0),t.refreshSuccessText="刷新失败",t.isreFreshLoading=!1;case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))()}}},p=f,v=(n("6cab"),n("2877")),m=Object(v["a"])(p,s,o,!1,null,"028044fe",null),b=m.exports,g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"channel-edit"},[n("van-cell",{attrs:{border:!1}},[n("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("我的频道")]),n("van-button",{staticClass:"edit-btn",attrs:{type:"danger",plain:"",round:"",size:"mini"},on:{click:function(e){t.isEdit=!t.isEdit}}},[t._v(t._s(t.isEdit?"完成":"编辑"))])],1),n("van-grid",{staticClass:"my-grid",attrs:{gutter:10}},t._l(t.myChannels,(function(e,a){return n("van-grid-item",{key:a,staticClass:"grid-item",on:{click:function(n){return t.onMyChannelClick(e,a)}}},[n("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.isEdit&&!t.fiexdChannels.includes(e.id),expression:"isEdit && !fiexdChannels.includes(channel.id)"}],attrs:{slot:"icon",name:"clear"},slot:"icon"}),n("span",{staticClass:"text",class:{active:a===t.active},attrs:{slot:"text"},slot:"text"},[t._v(t._s(e.name))])],1)})),1),n("van-cell",{attrs:{border:!1}},[n("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("频道推荐")])]),n("van-grid",{staticClass:"recommend-grid",attrs:{gutter:10}},t._l(t.recommendChannels,(function(e,a){return n("van-grid-item",{key:a,staticClass:"grid-item",attrs:{icon:"plus",text:e.name},on:{click:function(n){return t.onAddChannel(e)}}})})),1)],1)},C=[],x=(n("4de4"),n("7db0"),n("caad"),n("a434"),n("a9e3"),n("2532"),n("b775")),O=function(){return Object(x["a"])({method:"GET",url:"/app/v1_0/channels"})},E=function(t){return Object(x["a"])({method:"PATCH",url:"/app/v1_0/user/channels",data:{channels:[t]}})},_=function(t){return Object(x["a"])({method:"DELETE",url:"/app/v1_0/user/channels/".concat(t)})},j=n("2f62"),w=n("5d2d"),T={name:"ChannelEdit",props:{myChannels:{type:Array,required:!0},active:{type:Number,required:!0}},data:function(){return{allChannels:[],isEdit:!1,fiexdChannels:[0]}},computed:Object(c["a"])({},Object(j["b"])(["user"]),{recommendChannels:function(){var t=this;return this.allChannels.filter((function(e){return!t.myChannels.find((function(t){return t.id===e.id}))}))}}),created:function(){this.loadAllChannels()},methods:{loadAllChannels:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O();case 3:n=e.sent,a=n.data,t.allChannels=a.data.channels,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),t.$toast("数据获取失败");case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},onAddChannel:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.myChannels.push(t),!e.user){n.next=12;break}return n.prev=2,n.next=5,E({id:t.id,seq:e.myChannels.length});case 5:n.next=10;break;case 7:n.prev=7,n.t0=n["catch"](2),e.$toast("保存失败，请稍后重试");case 10:n.next=13;break;case 12:Object(w["b"])("TOUTIAO_CHANNELS",e.myChannels);case 13:case"end":return n.stop()}}),n,null,[[2,7]])})))()},onMyChannelClick:function(t,e){if(this.isEdit){if(this.fiexdChannels.includes(t.id))return;this.myChannels.splice(e,1),e<=this.active&&this.$emit("update-active",this.active-1,!0),this.deleteChannel(t)}else this.$emit("update-active",e,!1)},deleteChannel:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.prev=0,!e.user){n.next=6;break}return n.next=4,_(t.id);case 4:n.next=7;break;case 6:Object(w["b"])("TOUTIAO_CHANNELS",e.myChannels);case 7:n.next=12;break;case 9:n.prev=9,n.t0=n["catch"](0),e.$toast("操作失败，请稍后重试");case 12:case"end":return n.stop()}}),n,null,[[0,9]])})))()}}},k=T,A=(n("7192"),Object(v["a"])(k,g,C,!1,null,"3f93229f",null)),y=A.exports,N=n("c24f"),I={name:"HomeIndex",components:{ArticleList:b,ChannelEdit:y},data:function(){return{active:0,channels:[],isChennelEditShow:!1}},computed:Object(c["a"])({},Object(j["b"])(["user"])),watch:{user:function(){this.active=0,this.loadChannels()}},created:function(){this.loadChannels()},mounted:function(){},methods:{loadChannels:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a,r,i,c,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,n=[],!t.user){e.next=10;break}return e.next=5,Object(N["c"])();case 5:a=e.sent,r=a.data,n=r.data.channels,e.next=20;break;case 10:if(i=Object(w["a"])("TOUTIAO_CHANNELS"),!i){e.next=15;break}n=i,e.next=20;break;case 15:return e.next=17,Object(N["c"])();case 17:c=e.sent,s=c.data,n=s.data.channels;case 20:t.channels=n,e.next=26;break;case 23:e.prev=23,e.t0=e["catch"](0),t.$toast("获取频道数据失败");case 26:case"end":return e.stop()}}),e,null,[[0,23]])})))()},onUpdateActive:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.active=t,this.isChennelEditShow=e}}},S=I,L=(n("9d18"),Object(v["a"])(S,a,r,!1,null,"23970f5b",null));e["default"]=L.exports},"7db0":function(t,e,n){"use strict";var a=n("23e7"),r=n("b727").find,i=n("44d2"),c=n("ae40"),s="find",o=!0,u=c(s);s in[]&&Array(1)[s]((function(){o=!1})),a({target:"Array",proto:!0,forced:o||!u},{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),i(s)},"9d18":function(t,e,n){"use strict";var a=n("fb52"),r=n.n(a);r.a},a9e3:function(t,e,n){"use strict";var a=n("83ab"),r=n("da84"),i=n("94ca"),c=n("6eeb"),s=n("5135"),o=n("c6b6"),u=n("7156"),l=n("c04e"),d=n("d039"),h=n("7c73"),f=n("241c").f,p=n("06cf").f,v=n("9bf2").f,m=n("58a8").trim,b="Number",g=r[b],C=g.prototype,x=o(h(C))==b,O=function(t){var e,n,a,r,i,c,s,o,u=l(t,!1);if("string"==typeof u&&u.length>2)if(u=m(u),e=u.charCodeAt(0),43===e||45===e){if(n=u.charCodeAt(2),88===n||120===n)return NaN}else if(48===e){switch(u.charCodeAt(1)){case 66:case 98:a=2,r=49;break;case 79:case 111:a=8,r=55;break;default:return+u}for(i=u.slice(2),c=i.length,s=0;s<c;s++)if(o=i.charCodeAt(s),o<48||o>r)return NaN;return parseInt(i,a)}return+u};if(i(b,!g(" 0o1")||!g("0b1")||g("+0x1"))){for(var E,_=function(t){var e=arguments.length<1?0:t,n=this;return n instanceof _&&(x?d((function(){C.valueOf.call(n)})):o(n)!=b)?u(new g(O(e)),n,_):O(e)},j=a?f(g):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),w=0;j.length>w;w++)s(g,E=j[w])&&!s(_,E)&&v(_,E,p(g,E));_.prototype=C,C.constructor=_,c(r,b,_)}},c24f:function(t,e,n){"use strict";n.d(e,"f",(function(){return r})),n.d(e,"g",(function(){return i})),n.d(e,"d",(function(){return c})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return u})),n.d(e,"e",(function(){return l})),n.d(e,"i",(function(){return d})),n.d(e,"h",(function(){return h}));var a=n("b775"),r=function(t){return Object(a["a"])({method:"POST",url:"/app/v1_0/authorizations",data:t})},i=function(t){return Object(a["a"])({method:"GET",url:"/app/v1_0/sms/codes/".concat(t)})},c=function(){return Object(a["a"])({method:"GET",url:"/app/v1_0/user"})},s=function(){return Object(a["a"])({method:"GET",url:"/app/v1_0/user/channels"})},o=function(t){return Object(a["a"])({method:"POST",url:"/app/v1_0/user/followings",data:{target:t}})},u=function(t){return Object(a["a"])({method:"DELETE",url:"/app/v1_0/user/followings/".concat(t)})},l=function(t){return Object(a["a"])({method:"GET",url:"/app/v1_0/user/profile"})},d=function(t){return Object(a["a"])({method:"PATCH",url:"/app/v1_0/user/profile",data:t})},h=function(t){return Object(a["a"])({method:"PATCH",url:"/app/v1_0/user/photo",data:t})}},f8c1:function(t,e,n){},fb52:function(t,e,n){}}]);
//# sourceMappingURL=chunk-16b5b13b.421062d9.js.map